# è¨˜æ†¶ç¨®å­åˆä½µå·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ“– ç°¡ä»‹

è¨˜æ†¶ç¨®å­åˆä½µå·¥å…·ï¼ˆMemory Seeds Consolidation Toolï¼‰æ˜¯ä¸€å€‹è‡ªå‹•åŒ–å·¥å…·ï¼Œç”¨æ–¼å°‡å¤šå€‹è¨˜æ†¶ç¨®å­åˆä½µç‚ºæŒ‡å®šæ•¸é‡çš„ç¨®å­ï¼Œæœ‰æ•ˆç®¡ç†å’Œå„ªåŒ–è¨˜æ†¶å„²å­˜ç©ºé–“ã€‚

## ğŸ¯ ä½¿ç”¨å ´æ™¯

- ç•¶è¨˜æ†¶ç¨®å­æ•¸é‡éå¤šæ™‚ï¼Œåˆä½µç‚ºè¼ƒå°‘çš„ç¨®å­ä»¥ä¾¿ç®¡ç†
- æ•´åˆç›¸é—œçš„è¨˜æ†¶ç¨®å­ç‚ºå–®ä¸€è¨˜æ†¶å–®å…ƒ
- å„ªåŒ–å„²å­˜ç©ºé–“å’ŒæŸ¥è©¢æ•ˆç‡
- æº–å‚™è¨˜æ†¶å‚™ä»½æˆ–åŒ¯å‡º

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å‰µå»ºç¯„ä¾‹ç¨®å­ï¼ˆæ¸¬è©¦ç”¨ï¼‰

å¦‚æœæ‚¨æƒ³è¦æ¸¬è©¦åˆä½µåŠŸèƒ½ï¼Œå¯ä»¥å…ˆå‰µå»ºä¸€äº›ç¯„ä¾‹ç¨®å­ï¼š

```bash
cd particle_core/src

# å‰µå»º 25 å€‹ç¯„ä¾‹ç¨®å­
python create_sample_seeds.py --count 25

# å‰µå»ºæŒ‡å®šæ•¸é‡çš„ç¨®å­
python create_sample_seeds.py --count 50
```

### 2. åˆ—å‡ºç¾æœ‰ç¨®å­

```bash
# æŸ¥çœ‹æ‰€æœ‰è¨˜æ†¶ç¨®å­
python consolidate_memory_seeds.py --list
```

### 3. æ¨¡æ“¬åˆä½µï¼ˆä¸å¯¦éš›åŸ·è¡Œï¼‰

åœ¨å¯¦éš›åˆä½µå‰ï¼Œå»ºè­°å…ˆä½¿ç”¨ `--dry-run` æ¨¡å¼æŸ¥çœ‹åˆä½µè¨ˆåŠƒï¼š

```bash
# æ¨¡æ“¬åˆä½µè‡³ 10 å€‹ç¨®å­
python consolidate_memory_seeds.py --target 10 --dry-run

# ä½¿ç”¨ä¸åŒç­–ç•¥æ¨¡æ“¬
python consolidate_memory_seeds.py --target 10 --strategy by_date --dry-run
```

### 4. åŸ·è¡Œåˆä½µ

ç¢ºèªåˆä½µè¨ˆåŠƒå¾Œï¼ŒåŸ·è¡Œå¯¦éš›åˆä½µï¼š

```bash
# åˆä½µè‡³ 10 å€‹ç¨®å­ï¼ˆé è¨­ï¼‰
python consolidate_memory_seeds.py --target 10

# åˆä½µè‡³æŒ‡å®šæ•¸é‡
python consolidate_memory_seeds.py --target 5

# ä½¿ç”¨ç‰¹å®šç­–ç•¥
python consolidate_memory_seeds.py --target 10 --strategy by_date
```

## ğŸ“‹ å‘½ä»¤åƒæ•¸èªªæ˜

### åŸºæœ¬åƒæ•¸

| åƒæ•¸ | èªªæ˜ | é è¨­å€¼ |
|------|------|--------|
| `--target N` | ç›®æ¨™ç¨®å­æ•¸é‡ | 10 |
| `--strategy` | åˆä½µç­–ç•¥ | auto |
| `--storage PATH` | ç¨®å­å„²å­˜è·¯å¾‘ | memory_seeds |
| `--dry-run` | åªæ¨¡æ“¬ä¸å¯¦éš›åŸ·è¡Œ | - |
| `--list` | åˆ—å‡ºæ‰€æœ‰ç¨®å­ | - |
| `--cleanup` | æ¸…ç†èˆŠç¨®å­ | - |

### åˆä½µç­–ç•¥

- **auto**: è‡ªå‹•ç­–ç•¥ï¼ŒæŒ‰å‰µå»ºæ™‚é–“æ™ºèƒ½åˆ†çµ„
- **by_date**: æŒ‰æ—¥æœŸæ’åºï¼Œæ™‚é–“ç›¸è¿‘çš„ç¨®å­åˆä½µåœ¨ä¸€èµ·
- **by_size**: æŒ‰å¤§å°æ’åºï¼Œå¤§å°ç›¸è¿‘çš„ç¨®å­åˆä½µåœ¨ä¸€èµ·
- **even**: å¹³å‡åˆ†é…ï¼Œç›¡å¯èƒ½è®“æ¯çµ„ç¨®å­æ•¸é‡ç›¸è¿‘

## ğŸ“š ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1: åŸºæœ¬åˆä½µæµç¨‹

```bash
# æ­¥é©Ÿ 1: å‰µå»ºæ¸¬è©¦ç¨®å­
python create_sample_seeds.py --count 25

# æ­¥é©Ÿ 2: æŸ¥çœ‹ç•¶å‰ç¨®å­
python consolidate_memory_seeds.py --list

# æ­¥é©Ÿ 3: æ¨¡æ“¬åˆä½µ
python consolidate_memory_seeds.py --target 10 --dry-run

# æ­¥é©Ÿ 4: åŸ·è¡Œåˆä½µ
python consolidate_memory_seeds.py --target 10
```

### ç¯„ä¾‹ 2: ä½¿ç”¨ä¸åŒåˆä½µç­–ç•¥

```bash
# æŒ‰æ—¥æœŸåˆä½µ
python consolidate_memory_seeds.py --target 10 --strategy by_date

# å¹³å‡åˆ†é…åˆä½µ
python consolidate_memory_seeds.py --target 10 --strategy even
```

### ç¯„ä¾‹ 3: è‡ªè¨‚å„²å­˜è·¯å¾‘

```bash
# æŒ‡å®šè‡ªè¨‚è·¯å¾‘
python consolidate_memory_seeds.py --target 10 --storage /path/to/custom/seeds
```

### ç¯„ä¾‹ 4: Python ç¨‹å¼èª¿ç”¨

```python
from consolidate_memory_seeds import MemorySeedConsolidator

# å‰µå»ºåˆä½µå™¨
consolidator = MemorySeedConsolidator("memory_seeds")

# æŸ¥çœ‹æ‰€æœ‰ç¨®å­
seeds = consolidator.get_all_seeds()
print(f"ç•¶å‰æœ‰ {len(seeds)} å€‹ç¨®å­")

# åŸ·è¡Œåˆä½µ
result = consolidator.consolidate_to_target(
    target_count=10,
    strategy="auto",
    dry_run=False
)

print(f"åˆä½µå®Œæˆ: {result['final_count']} å€‹ç¨®å­")
```

## ğŸ” è¼¸å‡ºèªªæ˜

### åˆä½µéç¨‹è¼¸å‡º

```
============================================================
è¨˜æ†¶ç¨®å­åˆä½µå·¥å…· - Memory Seeds Consolidation
============================================================

ğŸ“Š ç•¶å‰ç¨®å­æ•¸é‡: 25
ğŸ¯ ç›®æ¨™ç¨®å­æ•¸é‡: 10
ğŸ“‹ åˆä½µç­–ç•¥: auto
ğŸ” æ¨¡æ“¬æ¨¡å¼: å¦

ğŸ”„ éœ€è¦æ¸›å°‘ 15 å€‹ç¨®å­

ğŸ“¦ åˆä½µè¨ˆåŠƒ:
   çµ„ 1: 3 å€‹ç¨®å­ â†’ åˆä½µç‚º 1 å€‹
      - sample_seed_001
      - sample_seed_002
      - sample_seed_003
   çµ„ 2: 3 å€‹ç¨®å­ â†’ åˆä½µç‚º 1 å€‹
      - sample_seed_004
      - sample_seed_005
      - sample_seed_006
   ...

ğŸš€ é–‹å§‹åˆä½µ...

åˆä½µçµ„ 1...
  âœ… å·²åˆä½µç‚º: consolidated_01_20250711_143022
åˆä½µçµ„ 2...
  âœ… å·²åˆä½µç‚º: consolidated_02_20250711_143023
...

âœ… åˆä½µå®Œæˆï¼
   åŸå§‹æ•¸é‡: 25
   æœ€çµ‚æ•¸é‡: 10
```

### åˆä½µçµæœçµæ§‹

```python
{
    "status": "success",
    "original_count": 25,
    "final_count": 10,
    "target_count": 10,
    "merged_seeds": [
        {
            "seed_name": "consolidated_01_...",
            "seed_file": "memory_seeds/consolidated_01_....mseed.json",
            "checksum": "...",
            "created_at": "..."
        },
        # ... å…¶ä»– 9 å€‹åˆä½µå¾Œçš„ç¨®å­
    ]
}
```

## âš ï¸ æ³¨æ„äº‹é …

### å®‰å…¨æ€§

1. **å‚™ä»½é‡è¦è³‡æ–™**: åˆä½µå‰å»ºè­°å…ˆå‚™ä»½é‡è¦çš„è¨˜æ†¶ç¨®å­
2. **ä½¿ç”¨ --dry-run**: å…ˆç”¨æ¨¡æ“¬æ¨¡å¼æŸ¥çœ‹åˆä½µè¨ˆåŠƒ
3. **é©—è­‰çµæœ**: åˆä½µå¾Œé©—è­‰è³‡æ–™å®Œæ•´æ€§
4. **ä¿ç•™åŸå§‹**: é è¨­ä¸åˆªé™¤åŸå§‹ç¨®å­ï¼Œéœ€æ‰‹å‹•ä½¿ç”¨ `--cleanup` æ¸…ç†

### æœ€ä½³å¯¦è¸

1. **åˆ†æ‰¹åˆä½µ**: å¤§é‡ç¨®å­å»ºè­°åˆ†æ‰¹åˆä½µ
2. **å®šæœŸç¶­è­·**: å®šæœŸåŸ·è¡Œåˆä½µä»¥ä¿æŒç¨®å­æ•¸é‡é©ç•¶
3. **é¸æ“‡ç­–ç•¥**: æ ¹æ“šè³‡æ–™ç‰¹æ€§é¸æ“‡åˆé©çš„åˆä½µç­–ç•¥
4. **è¨˜éŒ„æ—¥èªŒ**: ä¿ç•™åˆä½µæ“ä½œçš„è¨˜éŒ„

### é™åˆ¶

- åˆä½µæ“ä½œä¸å¯é€†ï¼Œåˆä½µå¾Œçš„ç¨®å­ç„¡æ³•è‡ªå‹•æ‹†åˆ†
- `--cleanup` åŠŸèƒ½éœ€è¦è¬¹æ…ä½¿ç”¨ï¼Œå»ºè­°æ‰‹å‹•å‚™ä»½å¾Œå†åŸ·è¡Œ
- å¤§é‡ç¨®å­åˆä½µå¯èƒ½éœ€è¦è¼ƒé•·æ™‚é–“

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œ 1: æ‰¾ä¸åˆ°ç¨®å­

**éŒ¯èª¤è¨Šæ¯**: `FileNotFoundError: è¨˜æ†¶ç¨®å­ä¸å­˜åœ¨`

**è§£æ±ºæ–¹æ³•**:
- ç¢ºèªç¨®å­è·¯å¾‘æ˜¯å¦æ­£ç¢º
- ä½¿ç”¨ `--list` æŸ¥çœ‹å¯ç”¨çš„ç¨®å­
- æª¢æŸ¥ç¨®å­åç¨±æ˜¯å¦æ­£ç¢º

### å•é¡Œ 2: æ¬Šé™éŒ¯èª¤

**éŒ¯èª¤è¨Šæ¯**: `PermissionError`

**è§£æ±ºæ–¹æ³•**:
- ç¢ºèªå°å„²å­˜ç›®éŒ„æœ‰è®€å¯«æ¬Šé™
- æª¢æŸ¥æª”æ¡ˆæ˜¯å¦è¢«å…¶ä»–ç¨‹å¼ä½”ç”¨

### å•é¡Œ 3: è¨˜æ†¶é«”ä¸è¶³

**è§£æ±ºæ–¹æ³•**:
- æ¸›å°‘ç›®æ¨™ç¨®å­æ•¸é‡ï¼Œåˆ†æ‰¹åˆä½µ
- é—œé–‰å…¶ä»–ä½”ç”¨è¨˜æ†¶é«”çš„ç¨‹å¼
- ä½¿ç”¨è¼ƒå°çš„ç¨®å­é€²è¡Œåˆä½µ

## ğŸ“ ç²å–å¹«åŠ©

```bash
# æŸ¥çœ‹å¹«åŠ©è³‡è¨Š
python consolidate_memory_seeds.py --help

# æŸ¥çœ‹ç¯„ä¾‹ç¨®å­å‰µå»ºå·¥å…·å¹«åŠ©
python create_sample_seeds.py --help
```

## ğŸ“ é€²éšä½¿ç”¨

### è‡ªè¨‚åˆä½µé‚è¼¯

æ‚¨å¯ä»¥æ“´å±• `MemorySeedConsolidator` é¡åˆ¥ä¾†å¯¦ç¾è‡ªè¨‚çš„åˆä½µé‚è¼¯ï¼š

```python
from consolidate_memory_seeds import MemorySeedConsolidator

class CustomConsolidator(MemorySeedConsolidator):
    def _create_merge_groups(self, seeds, target_count, strategy):
        # å¯¦ç¾æ‚¨çš„è‡ªè¨‚åˆ†çµ„é‚è¼¯
        if strategy == "my_custom_strategy":
            # è‡ªè¨‚ç­–ç•¥å¯¦ä½œ
            pass
        return super()._create_merge_groups(seeds, target_count, strategy)

# ä½¿ç”¨è‡ªè¨‚åˆä½µå™¨
consolidator = CustomConsolidator()
result = consolidator.consolidate_to_target(
    target_count=10,
    strategy="my_custom_strategy"
)
```

### èˆ‡ CI/CD æ•´åˆ

å¯ä»¥å°‡åˆä½µå·¥å…·æ•´åˆåˆ°è‡ªå‹•åŒ–æµç¨‹ä¸­ï¼š

```yaml
# GitHub Actions ç¯„ä¾‹
- name: Consolidate Memory Seeds
  run: |
    cd particle_core/src
    python consolidate_memory_seeds.py --target 10
```

## ğŸ“Š æ•ˆèƒ½æŒ‡æ¨™

| æ“ä½œ | 25 å€‹ç¨®å­ â†’ 10 å€‹ | 100 å€‹ç¨®å­ â†’ 10 å€‹ |
|------|-------------------|---------------------|
| æ¨¡æ“¬æ™‚é–“ | < 1 ç§’ | < 2 ç§’ |
| åˆä½µæ™‚é–“ | 2-3 ç§’ | 8-10 ç§’ |
| è¨˜æ†¶é«”ä½¿ç”¨ | < 50 MB | < 200 MB |

## ğŸ”— ç›¸é—œæ–‡æª”

- [è¨˜æ†¶å°å­˜ç¨®å­å¿«é€Ÿå…¥é–€](../../è¨˜æ†¶å°å­˜ç¨®å­å¿«é€Ÿå…¥é–€.md)
- [è¨˜æ†¶å°å­˜ç¨®å­ç³»çµ±èªªæ˜](../docs/è¨˜æ†¶å°å­˜ç¨®å­èªªæ˜.md)
- [æœ¬åœ°åŸ·è¡Œèªªæ˜](../docs/æœ¬åœ°åŸ·è¡Œèªªæ˜.md)

---

**å°ˆæ¡ˆ**: flow-tasks  
**å·¥å…·**: è¨˜æ†¶ç¨®å­åˆä½µå·¥å…· v1.0  
**ä½œè€…**: MRLiou / dofaromg  
**æ›´æ–°**: 2025-12-11
