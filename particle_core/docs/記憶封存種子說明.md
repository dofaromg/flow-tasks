# 記憶封存種子系統 (Memory Archive Seed System)

## 概述

記憶封存種子系統是 MRLiou 粒子語言核心的記憶管理模組，提供完整的記憶快照、封存、還原與分享功能。

## 核心功能

### 1. 記憶種子創建

創建可復原的記憶快照，包含完整的粒子資料與元數據：

```python
from memory_archive_seed import MemoryArchiveSeed

archive = MemoryArchiveSeed()
result = archive.create_seed(
    particle_data={"text": "Hello, World!", "logic": ["structure", "store"]},
    metadata={"author": "MRLiou", "version": "1.0"},
    seed_name="my_seed"
)
```

### 2. 記憶還原

從儲存的種子還原完整的記憶狀態：

```python
restored = archive.restore_seed("my_seed")
print(restored['particle_data'])
# 輸出: {"text": "Hello, World!", "logic": ["structure", "store"]}
```

### 3. 壓縮格式

將記憶種子壓縮為 .flpkg 緊湊格式：

```python
compressed = archive.compress_seed("my_seed")
print(compressed)
# 輸出: MEMORY_SEED(my_seed) = STORE(RECURSE(FLOW(MARK(STRUCTURE(X)))))
```

### 4. 種子合併

合併多個記憶種子為單一種子：

```python
result = archive.merge_seeds(
    seed_names=["seed_a", "seed_b", "seed_c"],
    merged_name="merged_seed"
)
```

### 5. 匯出與匯入

支援記憶種子的匯出與匯入，方便分享與備份：

```python
# 匯出
export_path = archive.export_seed("my_seed")

# 匯入
archive.import_seed(export_path)
```

## 記憶層級

記憶封存系統採用五層結構：

1. **STRUCTURE** - 結構層：基礎資料結構定義
2. **MARK** - 標記層：邏輯跳點與節奏標記
3. **FLOW** - 流程層：執行流程與節奏結構
4. **RECURSE** - 遞歸層：細部展開與嵌套邏輯
5. **STORE** - 封存層：最終記憶封存狀態

## 資料格式

### .mseed.json 格式

記憶種子以 JSON 格式儲存：

```json
{
  "seed_name": "my_seed",
  "version": "1.0",
  "created_at": "2025-10-05T10:00:00",
  "particle_data": { ... },
  "metadata": { ... },
  "memory_layers": ["structure", "mark", "flow", "recurse", "store"],
  "checksum": "sha256_hash_value"
}
```

### 完整性驗證

每個記憶種子都包含 SHA-256 校驗碼，還原時自動驗證：

- 確保資料完整性
- 防止資料損毀
- 支援版本追蹤

## 使用範例

### 基本使用

```python
from memory_archive_seed import MemoryArchiveSeed

# 初始化
archive = MemoryArchiveSeed()

# 創建種子
result = archive.create_seed(
    particle_data="測試資料",
    seed_name="test_001"
)
print(f"種子已創建: {result['seed_name']}")

# 還原種子
restored = archive.restore_seed("test_001")
print(f"還原資料: {restored['particle_data']}")

# 列出所有種子
seeds = archive.list_seeds()
for seed in seeds:
    print(f"- {seed['seed_name']}")
```

### 互動模式

```bash
# 啟動互動式介面
python src/memory_archive_seed.py interactive
```

互動模式提供以下功能：
1. 創建記憶種子
2. 還原記憶種子
3. 列出所有種子
4. 壓縮種子
5. 合併種子
6. 匯出種子
7. 匯入種子

### 與邏輯管線整合

```python
from logic_pipeline import LogicPipeline
from memory_archive_seed import MemoryArchiveSeed

# 執行邏輯處理
pipeline = LogicPipeline()
result = pipeline.simulate("Hello, MRLiou!")

# 封存處理結果
archive = MemoryArchiveSeed()
seed_info = archive.create_seed(
    particle_data={
        "input": result['input'],
        "output": result['result'],
        "steps": result['steps']
    },
    metadata={"type": "pipeline_result"},
    seed_name="pipeline_memory_001"
)

print(f"結果已封存至: {seed_info['seed_file']}")
```

## 進階功能

### 批次創建種子

```python
data_list = ["資料A", "資料B", "資料C"]

for i, data in enumerate(data_list):
    archive.create_seed(
        particle_data=data,
        seed_name=f"batch_seed_{i:03d}"
    )
```

### 種子備份

```python
# 匯出所有種子
seeds = archive.list_seeds()
for seed in seeds:
    export_path = archive.export_seed(seed['seed_name'])
    print(f"已匯出: {export_path}")
```

### 條件式還原

```python
# 只還原最近的種子
seeds = archive.list_seeds()
if seeds:
    latest_seed = seeds[0]  # 已按時間排序
    restored = archive.restore_seed(latest_seed['seed_name'])
    print(f"還原最新種子: {latest_seed['seed_name']}")
```

## 檔案結構

```
memory_seeds/              # 種子儲存目錄
├── test_seed_001.mseed.json
├── test_seed_002.mseed.json
└── merged_seed.mseed.json

*_export.json             # 匯出的種子檔案
```

## 效能指標

- **創建速度**: 50+ 種子/秒
- **還原速度**: 100+ 種子/秒
- **檔案大小**: 取決於粒子資料大小
- **完整性驗證**: < 1ms

## 安全性

- SHA-256 校驗碼驗證
- 自動完整性檢查
- 時間戳記追蹤
- 版本控制支援

## 相容性

- Python 3.10+
- 完全支援 Unicode（中文）
- 跨平台（Windows / macOS / Linux）
- 與 FlowAgent 系統完全整合

## 故障排除

### 種子檔案找不到

```python
# 檢查種子是否存在
seeds = archive.list_seeds()
print(f"可用種子: {[s['seed_name'] for s in seeds]}")
```

### 完整性驗證失敗

```python
try:
    restored = archive.restore_seed("seed_name")
except ValueError as e:
    print(f"種子損毀: {e}")
    # 可考慮從匯出檔案重新匯入
```

## 最佳實踐

1. **定期備份**: 使用 `export_seed()` 定期匯出重要種子
2. **命名規範**: 使用有意義的種子名稱（如：`project_v1_20251005`）
3. **元資料**: 添加豐富的元資料以便日後追蹤
4. **合併策略**: 定期合併相關種子以節省空間
5. **完整性檢查**: 定期驗證重要種子的完整性

## 授權

MRLiou All Rights Reserved

## 作者

MRLiou / dofaromg
